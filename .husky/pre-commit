#!/bin/bash

RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
BOLD='\033[1m'
RESET='\033[0m'

echo -e "${CYAN}${BOLD}üê∂ Husky pre-commit hook is running...${RESET}"

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\ |g')

if [ -n "$STAGED_FILES" ]; then
    echo -e "${CYAN}‚ú® Formatting staged files...${RESET}"
    prettier $STAGED_FILES --write --ignore-unknown

    if [ $? -ne 0 ]; then
        echo -e "${RED}${BOLD}‚ùå Prettier failed!${RESET}"
        exit 1
    fi

    echo -e "${CYAN}üî¨ Linting staged files...${RESET}"
    eslint --fix $STAGED_FILES

    if [ $? -ne 0 ]; then
        echo -e "${RED}${BOLD}‚ùå ESLint failed!${RESET}"
        exit 1
    fi

    git add $STAGED_FILES
else
    echo -e "${CYAN}No staged files to format${RESET}"
fi

echo -e "${GREEN}${BOLD}‚úÖ Husky pre-commit hook completed successfully!${RESET}"